<!DOCTYPE html>
<html>
<head>
  <title>Map</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  <script async type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link type="text/css" rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #map {
      height: 100%;
    }
  </style>
</head>
<body>
  <div class="container" style="width: 100%">
    <div class="row">
      <div class="col-md-3">
        <div class="btn-group">
          <div class="btn-group">
            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
              Filter Location <span class="caret"></span></button>
              <ul class="dropdown-menu" role="menu" data-bind="foreach: marker">
                <li><a href="#" data-bind="click: showAlone"><span data-bind="text: name"></span></a></li>
              </ul>
            </div>
            <button type="button" class="btn btn-primary" data-bind="click: FullView">Show All</button>
            <button type="button" class="btn btn-primary" data-bind="click: ClearView">Hide All</button>
          </div>
          <table>
            <thead><tr>
              <th>Location</th>
            </tr></thead>
            <tbody data-bind="foreach: marker">
              <!-- ko if: show-->
              <tr>
                <td data-bind="text: name, click: details"></td>
              </tr>  
              <!-- /ko -->
            </tbody>
          </table>
        </div>
        <div class="col-md-9" id="map" style="height: 400px">

        </div>
      </div>
    </div>
    <footer>
    powered by horribly js, jquery, knockout, gmaps, flickr, bootstrap
     and <a href="https://www.doogal.co.uk/FullScreen.php">doogal</a>
    </footer>
    <script async src="js/knockout-3.4.1.js" onerror="knockoutError()"></script>
    <script>
      var flickrapikey = "b522feb6513d0401a1e27cc438739776";
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 52.520007, lng: 13.404954},
          zoom: 13
        });
  //thanks to https://www.doogal.co.uk/FullScreen.php
  map.controls[google.maps.ControlPosition.TOP_RIGHT].push(
   FullScreenControl(map));


  function MapMarker(name, lat, lng) {
    var self = this;
    self.name = name;
    self.lat = lat;
    self.lng = lng;
    self.marker = new google.maps.Marker({
      position: {lat: self.lat, lng: self.lng},
      map: map,
      title: self.name
    });
    self.show = ko.observable(true);
    self.showAlone = function() {
      if (vm.filtered == false) {
        vm.ClearView(); 
        vm.filtered = true; 
      }
      self.marker.setMap(map);
      self.show(true);
      self.marker.setAnimation(google.maps.Animation.BOUNCE);
    }
    self.details = function () {
      //get images from flickr and generate the info window.
      $.getJSON("http://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",
      {
        tags: self.name,
        tagmode: "any",
        format: "json"
      },
      function(data) {
        ret = "<div>"
        ret += '<h2>' + self.name + '</h2>'
        $.each(data.items, function(i,item){
          ret += '<img src="' + item.media.m + '">'
          if (i > 2) {
            return false;
          }
        });
        ret += "</div>"
        if (vm.infowindow){
          vm.infowindow.close();
        }
        vm.infowindow = new google.maps.InfoWindow({
          content: ret
        });
        vm.infowindow.open(map, self.marker)
      });
    }
  }

          // Overall viewmodel for this screen, along with initial state
          function MarkerViewModel() {
            var self = this;   
            self.filtered = false;
              // Initial data
              self.marker = [
              new MapMarker("Alex", 52.521649, 13.411313),
              new MapMarker("Rotes Rathaus", 52.518450, 13.408309),
              new MapMarker("Reichstag", 52.518437, 13.375329),
              new MapMarker("Rosa-Luxemburg-Platz", 52.528646, 13.410090),
              new MapMarker("Checkpoint Charly", 52.507337, 13.390199)
              ];
              function setMapOnAll(map,on) {
                for (var i = 0; i < self.marker.length; i++) {
                  self.marker[i].marker.setMap(map);
                  self.marker[i].show(on);
                }
              }
              self.FilterList = ko.computed(function() {
                return ko.utils.arrayFilter(self.marker, function(marker) {
                  return marker.show;
                });
              });
              self.ClearView = function() {
                self.filtered = true;
                setMapOnAll(null, false);
              }
              self.FullView = function() {
                self.filtered = false;
                setMapOnAll(map, true);
              }


            }
            vm = new MarkerViewModel()
            ko.applyBindings(vm);
          }
          function googleError() {
            window.alert("Failed to load Map API, pls reload.");
          }
          function knockoutError() {
            window.alert("Failed to load  knockout, pls reload.");
          }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGOlipwaSYGQDs1YAnmhCNx_dkOlYc_dk&callback=initMap"
        async defer onerror="googleError()""></script>
        <script src="js/FullScreenControl.js" type="text/javascript"></script>
      </body>
      </html>